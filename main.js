/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => OthTool
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var import_child_process = require("child_process");
var import_fs = require("fs");
var DEFAULT_SETTINGS = {
  pythonPath: "python3",
  othToolPath: "",
  mensaplanFile: "Mensaplan.md",
  cloneRepo: false,
  autoOpen: true,
  fetchOnFirstOpen: false
};
var OthTool = class extends import_obsidian.Plugin {
  constructor() {
    super(...arguments);
    this.oth_tool_repo_url = "https://github.com/Acoiny/oth-scrape-tool";
  }
  async onload() {
    await this.loadSettings();
    let vaultPath = "";
    if (this.app.vault.adapter instanceof import_obsidian.FileSystemAdapter) {
      vaultPath = this.app.vault.adapter.getBasePath();
    }
    this.vault_base_path = vaultPath;
    this.oth_tool_repo_path = vaultPath + "/" + this.manifest.dir + "/oth-scrape-tool";
    if (this.settings.cloneRepo) {
      this.updateRepo();
    }
    if (this.settings.fetchOnFirstOpen) {
      (0, import_fs.stat)(this.vault_base_path + "/" + this.settings.mensaplanFile, (err, stats) => {
        if (err) {
          console.log(err);
          this.fetchMensaplan();
          return;
        }
        const today = new Date();
        const acc = stats.mtime;
        if (!(today.getFullYear() == acc.getFullYear() && today.getMonth() == acc.getMonth() && today.getDate() == acc.getDate())) {
          this.fetchMensaplan();
        }
      });
    }
    this.addCommand({
      id: "fetch-oth-mensaplan",
      name: "Fetch OTH-Mensaplan",
      callback: () => {
        this.fetchMensaplan();
      }
    });
    this.addCommand({
      id: "clone-oth-scrape-tool",
      name: "Clone the oth-scrape-tool",
      callback: () => {
        this.updateRepo();
      }
    });
    this.addCommand({
      id: "remove-oth-scrape-tool",
      name: "Remove the cloned oth-scrape-tool",
      callback: () => {
        if ((0, import_fs.existsSync)(this.oth_tool_repo_path)) {
          (0, import_fs.rm)(this.oth_tool_repo_path, { force: true, recursive: true }, (error) => {
            if (error)
              new OthToolModal(this.app, `Unable to remove tool: ${error}`).open();
          });
        }
      }
    });
    this.addSettingTab(new SampleSettingTab(this.app, this));
  }
  onunload() {
  }
  /**
   * Executes git pull inside the repo,
   * or freshly clones it if it isn't present
   */
  updateRepo() {
    if (!(0, import_fs.existsSync)(this.oth_tool_repo_path)) {
      this.cloneRepoIfNotExists();
      return;
    }
    const cmd = `cd ${this.oth_tool_repo_path} && git pull`;
    console.log(cmd);
    (0, import_child_process.exec)(cmd, (error, stdout, stderr) => {
      if (error) {
        new OthToolModal(this.app, `Error git pull: ${error}`).open();
        return;
      }
      console.log(stdout);
      if (stderr)
        console.error(stderr);
    });
  }
  cloneRepoIfNotExists() {
    if ((0, import_fs.existsSync)(this.oth_tool_repo_path))
      return;
    const cmd = `git clone ${this.oth_tool_repo_url} ${this.oth_tool_repo_path}`;
    (0, import_child_process.exec)(cmd, (error, stdout, stderr) => {
      if (error) {
        new OthToolModal(this.app, `Error on clone: ${error}`).open();
        return;
      }
      console.log(stdout);
      if (stderr)
        console.error(stderr);
    });
  }
  fetchMensaplan() {
    const pythonPath = this.settings.pythonPath;
    const mensaplan = this.settings.mensaplanFile.endsWith(".md") ? this.settings.mensaplanFile : this.settings.mensaplanFile + ".md";
    const cmd = `"${pythonPath}" "${this.oth_tool_repo_path + "/oth_tool.py"}" m -mt > "${this.vault_base_path + "/" + mensaplan}"`;
    console.log("Executing: ", cmd);
    (0, import_child_process.exec)(cmd, (error, stdout, stderr) => {
      if (error) {
        new OthToolModal(this.app, `Error on getting mensaplan: ${error}`).open();
        return;
      }
      console.log(stdout);
      if (stderr)
        console.error(stderr);
      if (this.settings.autoOpen) {
        const file = this.app.vault.getAbstractFileByPath(this.settings.mensaplanFile);
        if (file)
          this.app.workspace.openLinkText(this.settings.mensaplanFile, "", false);
      }
    });
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
var OthToolModal = class extends import_obsidian.Modal {
  constructor(app, message) {
    super(app);
    this.message = message;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.setText(this.message);
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};
var SampleSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian.Setting(containerEl).setName("Python path").setDesc("Path to the python interpreter used to fetch the 				mensaplan. Can be inside a virtual environment (Recommended).").addText((text) => text.setPlaceholder("/path/to/python3").setValue(this.plugin.settings.pythonPath).onChange(async (value) => {
      this.plugin.settings.pythonPath = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Clone tool").setDesc("Automatically clone and pull new versions of the the oth-tool into this plugin's folder").addToggle((cp) => cp.setValue(this.plugin.settings.cloneRepo).onChange(async (value) => {
      this.plugin.settings.cloneRepo = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Auto open").setDesc("Automatically open the mensaplan after fetching it").addToggle((cp) => cp.setValue(this.plugin.settings.autoOpen).onChange(async (value) => {
      this.plugin.settings.autoOpen = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Fetch on open").setDesc("Fetches the mensaplan if no Mensaplan file from today has been found on opening obsidian").addToggle((cp) => cp.setValue(this.plugin.settings.fetchOnFirstOpen).onChange(async (value) => {
      this.plugin.settings.fetchOnFirstOpen = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Mensaplan.md").setDesc("Path to store the mensaplan inside the vault.").addText((text) => text.setPlaceholder("Mensaplan.md").setValue(this.plugin.settings.mensaplanFile).onChange(async (value) => {
      this.plugin.settings.mensaplanFile = value;
      await this.plugin.saveSettings();
    }));
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBFZGl0b3IsIEZpbGVTeXN0ZW1BZGFwdGVyLCBNYXJrZG93blZpZXcsIE1vZGFsLCBOb3RpY2UsIFBsdWdpbiwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZywgVEZpbGUgfSBmcm9tICdvYnNpZGlhbic7XG5cbmltcG9ydCB7IGV4ZWMgfSBmcm9tICdjaGlsZF9wcm9jZXNzJztcbmltcG9ydCB7IGV4aXN0c1N5bmMsIHJtLCBzdGF0IH0gZnJvbSAnZnMnO1xuXG4vLyBSZW1lbWJlciB0byByZW5hbWUgdGhlc2UgY2xhc3NlcyBhbmQgaW50ZXJmYWNlcyFcblxuaW50ZXJmYWNlIE15UGx1Z2luU2V0dGluZ3Mge1xuXHRweXRob25QYXRoOiBzdHJpbmc7XG5cdG90aFRvb2xQYXRoOiBzdHJpbmc7XG5cdG1lbnNhcGxhbkZpbGU6IHN0cmluZztcblx0Y2xvbmVSZXBvOiBib29sZWFuO1xuXHRhdXRvT3BlbjogYm9vbGVhbjsgLy8gYXV0b21hdGljYWxseSBvcGVuIHRoZSBtZW5zYXBsYW4gYWZ0ZXIgcHVsbGluZyBpdFxuXHRmZXRjaE9uRmlyc3RPcGVuOiBib29sZWFuOyAvLyBmZXRjaCB0aGUgbWVuc2FwbGFuLCBpZiBubyBtZW5zYXBsYW4gZmlsZSBmcm9tIHRvZGF5IGhhcyBiZWVuIGZvdW5kXG59XG5cblxuXG5jb25zdCBERUZBVUxUX1NFVFRJTkdTOiBNeVBsdWdpblNldHRpbmdzID0ge1xuXHRweXRob25QYXRoOiAncHl0aG9uMycsXG5cdG90aFRvb2xQYXRoOiAnJyxcblx0bWVuc2FwbGFuRmlsZTogJ01lbnNhcGxhbi5tZCcsXG5cdGNsb25lUmVwbzogZmFsc2UsXG5cdGF1dG9PcGVuOiB0cnVlLFxuXHRmZXRjaE9uRmlyc3RPcGVuOiBmYWxzZSxcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgT3RoVG9vbCBleHRlbmRzIFBsdWdpbiB7XG5cdHNldHRpbmdzOiBNeVBsdWdpblNldHRpbmdzO1xuXG5cdC8vIHBhdGggd2hlcmUgdGhlIG1lbnNhdG9vbCBzaG91bGQgYmUgY2xvbmVkIGludG9cblx0b3RoX3Rvb2xfcmVwb19wYXRoOiBzdHJpbmc7XG5cblx0dmF1bHRfYmFzZV9wYXRoOiBzdHJpbmc7XG5cblx0dmVudl9kYXRhOiB7IGJhc2VQYXRoOiBzdHJpbmcsIHB5dGhvbjogc3RyaW5nIH1cblxuXHRyZWFkb25seSBvdGhfdG9vbF9yZXBvX3VybDogc3RyaW5nID0gJ2h0dHBzOi8vZ2l0aHViLmNvbS9BY29pbnkvb3RoLXNjcmFwZS10b29sJztcblxuXHRhc3luYyBvbmxvYWQoKSB7XG5cdFx0YXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcblxuXHRcdGxldCB2YXVsdFBhdGggPSAnJztcblx0XHRpZiAodGhpcy5hcHAudmF1bHQuYWRhcHRlciBpbnN0YW5jZW9mIEZpbGVTeXN0ZW1BZGFwdGVyKSB7XG5cdFx0XHR2YXVsdFBhdGggPSB0aGlzLmFwcC52YXVsdC5hZGFwdGVyLmdldEJhc2VQYXRoKCk7XG5cdFx0fVxuXHRcdHRoaXMudmF1bHRfYmFzZV9wYXRoID0gdmF1bHRQYXRoO1xuXG5cdFx0dGhpcy5vdGhfdG9vbF9yZXBvX3BhdGggPSB2YXVsdFBhdGggKyAnLycgKyB0aGlzLm1hbmlmZXN0LmRpciArICcvb3RoLXNjcmFwZS10b29sJztcblxuXHRcdGlmICh0aGlzLnNldHRpbmdzLmNsb25lUmVwbykge1xuXHRcdFx0dGhpcy51cGRhdGVSZXBvKCk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMuc2V0dGluZ3MuZmV0Y2hPbkZpcnN0T3Blbikge1xuXHRcdFx0c3RhdCh0aGlzLnZhdWx0X2Jhc2VfcGF0aCArICcvJyArIHRoaXMuc2V0dGluZ3MubWVuc2FwbGFuRmlsZSwgKGVyciwgc3RhdHMpID0+IHtcblx0XHRcdFx0aWYgKGVycikge1xuXHRcdFx0XHRcdC8vIGZpbGUgZG9lc24ndCBleGlzdCFcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhlcnIpO1xuXHRcdFx0XHRcdHRoaXMuZmV0Y2hNZW5zYXBsYW4oKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjb25zdCB0b2RheSA9IG5ldyBEYXRlKCk7XG5cdFx0XHRcdGNvbnN0IGFjYyA9IHN0YXRzLm10aW1lO1xuXG5cdFx0XHRcdGlmICghKHRvZGF5LmdldEZ1bGxZZWFyKCkgPT0gYWNjLmdldEZ1bGxZZWFyKCkgJiZcblx0XHRcdFx0XHR0b2RheS5nZXRNb250aCgpID09IGFjYy5nZXRNb250aCgpICYmXG5cdFx0XHRcdFx0dG9kYXkuZ2V0RGF0ZSgpID09IGFjYy5nZXREYXRlKCkpKSB7XG5cdFx0XHRcdFx0Ly8gTk9UIG9uIHRoZSBzYW1lIGRheSFcblx0XHRcdFx0XHR0aGlzLmZldGNoTWVuc2FwbGFuKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0fVxuXG5cdFx0Ly8gVGhpcyBhZGRzIGEgc2ltcGxlIGNvbW1hbmQgdGhhdCBjYW4gYmUgdHJpZ2dlcmVkIGFueXdoZXJlXG5cdFx0dGhpcy5hZGRDb21tYW5kKHtcblx0XHRcdGlkOiAnZmV0Y2gtb3RoLW1lbnNhcGxhbicsXG5cdFx0XHRuYW1lOiAnRmV0Y2ggT1RILU1lbnNhcGxhbicsXG5cdFx0XHRjYWxsYmFjazogKCkgPT4ge1xuXHRcdFx0XHR0aGlzLmZldGNoTWVuc2FwbGFuKCk7XG5cdFx0XHRcdC8vbmV3IEVycm9yTW9kYWwodGhpcy5hcHAsIFwiVW5hYmxlIHRvIGZldGNoIG1lbnNhcGxhblwiKS5vcGVuKCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHR0aGlzLmFkZENvbW1hbmQoe1xuXHRcdFx0aWQ6ICdjbG9uZS1vdGgtc2NyYXBlLXRvb2wnLFxuXHRcdFx0bmFtZTogJ0Nsb25lIHRoZSBvdGgtc2NyYXBlLXRvb2wnLFxuXHRcdFx0Y2FsbGJhY2s6ICgpID0+IHtcblx0XHRcdFx0dGhpcy51cGRhdGVSZXBvKCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHR0aGlzLmFkZENvbW1hbmQoe1xuXHRcdFx0aWQ6ICdyZW1vdmUtb3RoLXNjcmFwZS10b29sJyxcblx0XHRcdG5hbWU6ICdSZW1vdmUgdGhlIGNsb25lZCBvdGgtc2NyYXBlLXRvb2wnLFxuXHRcdFx0Y2FsbGJhY2s6ICgpID0+IHtcblx0XHRcdFx0aWYgKGV4aXN0c1N5bmModGhpcy5vdGhfdG9vbF9yZXBvX3BhdGgpKSB7XG5cdFx0XHRcdFx0cm0odGhpcy5vdGhfdG9vbF9yZXBvX3BhdGgsIHsgZm9yY2U6IHRydWUsIHJlY3Vyc2l2ZTogdHJ1ZSB9LCAoZXJyb3IpID0+IHtcblx0XHRcdFx0XHRcdGlmIChlcnJvcilcblx0XHRcdFx0XHRcdFx0bmV3IE90aFRvb2xNb2RhbCh0aGlzLmFwcCwgYFVuYWJsZSB0byByZW1vdmUgdG9vbDogJHtlcnJvcn1gKS5vcGVuKCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdC8vIFRPRE86IGFkZCBjb21tYW5kIHRvIHB1bGwgbWVuc2FwbGFuIEFORCBkaXJlY3RseSBvcGVuIGl0XG5cblx0XHQvLyBUaGlzIGFkZHMgYSBzZXR0aW5ncyB0YWIgc28gdGhlIHVzZXIgY2FuIGNvbmZpZ3VyZSB2YXJpb3VzIGFzcGVjdHMgb2YgdGhlIHBsdWdpblxuXHRcdHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgU2FtcGxlU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xuXG5cdFx0Ly8gSWYgdGhlIHBsdWdpbiBob29rcyB1cCBhbnkgZ2xvYmFsIERPTSBldmVudHMgKG9uIHBhcnRzIG9mIHRoZSBhcHAgdGhhdCBkb2Vzbid0IGJlbG9uZyB0byB0aGlzIHBsdWdpbilcblx0XHQvLyBVc2luZyB0aGlzIGZ1bmN0aW9uIHdpbGwgYXV0b21hdGljYWxseSByZW1vdmUgdGhlIGV2ZW50IGxpc3RlbmVyIHdoZW4gdGhpcyBwbHVnaW4gaXMgZGlzYWJsZWQuXG5cdFx0Ly8gdGhpcy5yZWdpc3RlckRvbUV2ZW50KGRvY3VtZW50LCAnY2xpY2snLCAoZXZ0OiBNb3VzZUV2ZW50KSA9PiB7XG5cdFx0Ly8gXHRjb25zb2xlLmxvZygnY2xpY2snLCBldnQpO1xuXHRcdC8vIH0pO1xuXG5cdFx0Ly8gV2hlbiByZWdpc3RlcmluZyBpbnRlcnZhbHMsIHRoaXMgZnVuY3Rpb24gd2lsbCBhdXRvbWF0aWNhbGx5IGNsZWFyIHRoZSBpbnRlcnZhbCB3aGVuIHRoZSBwbHVnaW4gaXMgZGlzYWJsZWQuXG5cdFx0Ly8gdGhpcy5yZWdpc3RlckludGVydmFsKHdpbmRvdy5zZXRJbnRlcnZhbCgoKSA9PiBjb25zb2xlLmxvZygnc2V0SW50ZXJ2YWwnKSwgNSAqIDYwICogMTAwMCkpO1xuXHR9XG5cblx0b251bmxvYWQoKSB7XG5cblx0fVxuXG5cdC8qKlxuXHQgKiBFeGVjdXRlcyBnaXQgcHVsbCBpbnNpZGUgdGhlIHJlcG8sXG5cdCAqIG9yIGZyZXNobHkgY2xvbmVzIGl0IGlmIGl0IGlzbid0IHByZXNlbnRcblx0ICovXG5cdHVwZGF0ZVJlcG8oKSB7XG5cdFx0aWYgKCFleGlzdHNTeW5jKHRoaXMub3RoX3Rvb2xfcmVwb19wYXRoKSkge1xuXHRcdFx0dGhpcy5jbG9uZVJlcG9JZk5vdEV4aXN0cygpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRjb25zdCBjbWQgPSBgY2QgJHt0aGlzLm90aF90b29sX3JlcG9fcGF0aH0gJiYgZ2l0IHB1bGxgO1xuXHRcdGNvbnNvbGUubG9nKGNtZCk7XG5cdFx0ZXhlYyhjbWQsIChlcnJvciwgc3Rkb3V0LCBzdGRlcnIpID0+IHtcblx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRuZXcgT3RoVG9vbE1vZGFsKHRoaXMuYXBwLCBgRXJyb3IgZ2l0IHB1bGw6ICR7ZXJyb3J9YCkub3BlbigpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHRjb25zb2xlLmxvZyhzdGRvdXQpO1xuXHRcdFx0aWYgKHN0ZGVycilcblx0XHRcdFx0Y29uc29sZS5lcnJvcihzdGRlcnIpO1xuXHRcdH0pO1xuXHR9XG5cblx0Y2xvbmVSZXBvSWZOb3RFeGlzdHMoKSB7XG5cdFx0aWYgKGV4aXN0c1N5bmModGhpcy5vdGhfdG9vbF9yZXBvX3BhdGgpKSByZXR1cm47XG5cblx0XHRjb25zdCBjbWQgPSBgZ2l0IGNsb25lICR7dGhpcy5vdGhfdG9vbF9yZXBvX3VybH0gJHt0aGlzLm90aF90b29sX3JlcG9fcGF0aH1gO1xuXG5cdFx0ZXhlYyhjbWQsIChlcnJvciwgc3Rkb3V0LCBzdGRlcnIpID0+IHtcblx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRuZXcgT3RoVG9vbE1vZGFsKHRoaXMuYXBwLCBgRXJyb3Igb24gY2xvbmU6ICR7ZXJyb3J9YCkub3BlbigpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHRjb25zb2xlLmxvZyhzdGRvdXQpO1xuXHRcdFx0aWYgKHN0ZGVycilcblx0XHRcdFx0Y29uc29sZS5lcnJvcihzdGRlcnIpO1xuXHRcdH0pO1xuXG5cdFx0Ly8gbm93IGNyZWF0ZSB0aGUgdmVudlxuXHR9XG5cblx0ZmV0Y2hNZW5zYXBsYW4oKSB7XG5cdFx0Y29uc3QgcHl0aG9uUGF0aCA9IHRoaXMuc2V0dGluZ3MucHl0aG9uUGF0aDtcblx0XHRjb25zdCBtZW5zYXBsYW4gPSB0aGlzLnNldHRpbmdzLm1lbnNhcGxhbkZpbGUuZW5kc1dpdGgoJy5tZCcpID8gdGhpcy5zZXR0aW5ncy5tZW5zYXBsYW5GaWxlIDogdGhpcy5zZXR0aW5ncy5tZW5zYXBsYW5GaWxlICsgJy5tZCc7XG5cblx0XHRjb25zdCBjbWQgPSBgXCIke3B5dGhvblBhdGh9XCIgXCIke3RoaXMub3RoX3Rvb2xfcmVwb19wYXRoICsgJy9vdGhfdG9vbC5weSd9XCIgbSAtbXQgPiBcIiR7dGhpcy52YXVsdF9iYXNlX3BhdGggKyAnLycgKyBtZW5zYXBsYW59XCJgXG5cdFx0Y29uc29sZS5sb2coXCJFeGVjdXRpbmc6IFwiLCBjbWQpO1xuXHRcdGV4ZWMoY21kLCAoZXJyb3IsIHN0ZG91dCwgc3RkZXJyKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0bmV3IE90aFRvb2xNb2RhbCh0aGlzLmFwcCwgYEVycm9yIG9uIGdldHRpbmcgbWVuc2FwbGFuOiAke2Vycm9yfWApLm9wZW4oKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRjb25zb2xlLmxvZyhzdGRvdXQpO1xuXHRcdFx0aWYgKHN0ZGVycilcblx0XHRcdFx0Y29uc29sZS5lcnJvcihzdGRlcnIpO1xuXG5cdFx0XHRpZiAodGhpcy5zZXR0aW5ncy5hdXRvT3Blbikge1xuXHRcdFx0XHRjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHRoaXMuc2V0dGluZ3MubWVuc2FwbGFuRmlsZSk7XG5cdFx0XHRcdGlmIChmaWxlKVxuXHRcdFx0XHRcdHRoaXMuYXBwLndvcmtzcGFjZS5vcGVuTGlua1RleHQodGhpcy5zZXR0aW5ncy5tZW5zYXBsYW5GaWxlLCAnJywgZmFsc2UpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0YXN5bmMgbG9hZFNldHRpbmdzKCkge1xuXHRcdHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xuXHR9XG5cblx0YXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuXHRcdGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XG5cdH1cbn1cblxuXG5jbGFzcyBPdGhUb29sTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG5cdG1lc3NhZ2U6IHN0cmluZztcblxuXHRjb25zdHJ1Y3RvcihhcHA6IEFwcCwgbWVzc2FnZTogc3RyaW5nKSB7XG5cdFx0c3VwZXIoYXBwKTtcblx0XHR0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlO1xuXHR9XG5cblx0b25PcGVuKCkge1xuXHRcdGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuXHRcdGNvbnRlbnRFbC5zZXRUZXh0KHRoaXMubWVzc2FnZSk7XG5cdH1cblxuXHRvbkNsb3NlKCkge1xuXHRcdGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuXHRcdGNvbnRlbnRFbC5lbXB0eSgpO1xuXHR9XG59XG5cbmNsYXNzIFNhbXBsZVNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcblx0cGx1Z2luOiBPdGhUb29sO1xuXG5cdGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IE90aFRvb2wpIHtcblx0XHRzdXBlcihhcHAsIHBsdWdpbik7XG5cdFx0dGhpcy5wbHVnaW4gPSBwbHVnaW47XG5cdH1cblxuXHRkaXNwbGF5KCk6IHZvaWQge1xuXHRcdGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG5cblx0XHRjb250YWluZXJFbC5lbXB0eSgpO1xuXG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG5cdFx0XHQuc2V0TmFtZSgnUHl0aG9uIHBhdGgnKVxuXHRcdFx0LnNldERlc2MoJ1BhdGggdG8gdGhlIHB5dGhvbiBpbnRlcnByZXRlciB1c2VkIHRvIGZldGNoIHRoZSBcXFxuXHRcdFx0XHRtZW5zYXBsYW4uIENhbiBiZSBpbnNpZGUgYSB2aXJ0dWFsIGVudmlyb25tZW50IChSZWNvbW1lbmRlZCkuJylcblx0XHRcdC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuXHRcdFx0XHQuc2V0UGxhY2Vob2xkZXIoJy9wYXRoL3RvL3B5dGhvbjMnKVxuXHRcdFx0XHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MucHl0aG9uUGF0aClcblx0XHRcdFx0Lm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdHRoaXMucGx1Z2luLnNldHRpbmdzLnB5dGhvblBhdGggPSB2YWx1ZTtcblx0XHRcdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblx0XHRcdFx0fSkpO1xuXG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG5cdFx0XHQuc2V0TmFtZSgnQ2xvbmUgdG9vbCcpXG5cdFx0XHQuc2V0RGVzYygnQXV0b21hdGljYWxseSBjbG9uZSBhbmQgcHVsbCBuZXcgdmVyc2lvbnMgb2YgdGhlIHRoZSBvdGgtdG9vbCBpbnRvIHRoaXMgcGx1Z2luXFwncyBmb2xkZXInKVxuXHRcdFx0LmFkZFRvZ2dsZShjcCA9PiBjcFxuXHRcdFx0XHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuY2xvbmVSZXBvKVxuXHRcdFx0XHQub25DaGFuZ2UoYXN5bmMgdmFsdWUgPT4ge1xuXHRcdFx0XHRcdHRoaXMucGx1Z2luLnNldHRpbmdzLmNsb25lUmVwbyA9IHZhbHVlO1xuXHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXHRcdFx0XHR9KSk7XG5cblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbClcblx0XHRcdC5zZXROYW1lKCdBdXRvIG9wZW4nKVxuXHRcdFx0LnNldERlc2MoJ0F1dG9tYXRpY2FsbHkgb3BlbiB0aGUgbWVuc2FwbGFuIGFmdGVyIGZldGNoaW5nIGl0Jylcblx0XHRcdC5hZGRUb2dnbGUoY3AgPT4gY3Bcblx0XHRcdFx0LnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9PcGVuKVxuXHRcdFx0XHQub25DaGFuZ2UoYXN5bmMgdmFsdWUgPT4ge1xuXHRcdFx0XHRcdHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9PcGVuID0gdmFsdWU7XG5cdFx0XHRcdFx0YXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cdFx0XHRcdH0pKTtcblxuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuXHRcdFx0LnNldE5hbWUoJ0ZldGNoIG9uIG9wZW4nKVxuXHRcdFx0LnNldERlc2MoJ0ZldGNoZXMgdGhlIG1lbnNhcGxhbiBpZiBubyBNZW5zYXBsYW4gZmlsZSBmcm9tIHRvZGF5IGhhcyBiZWVuIGZvdW5kIG9uIG9wZW5pbmcgb2JzaWRpYW4nKVxuXHRcdFx0LmFkZFRvZ2dsZShjcCA9PiBjcFxuXHRcdFx0XHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZmV0Y2hPbkZpcnN0T3Blbilcblx0XHRcdFx0Lm9uQ2hhbmdlKGFzeW5jIHZhbHVlID0+IHtcblx0XHRcdFx0XHR0aGlzLnBsdWdpbi5zZXR0aW5ncy5mZXRjaE9uRmlyc3RPcGVuID0gdmFsdWU7XG5cdFx0XHRcdFx0YXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cdFx0XHRcdH0pKTtcblxuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuXHRcdFx0LnNldE5hbWUoJ01lbnNhcGxhbi5tZCcpXG5cdFx0XHQuc2V0RGVzYygnUGF0aCB0byBzdG9yZSB0aGUgbWVuc2FwbGFuIGluc2lkZSB0aGUgdmF1bHQuJylcblx0XHRcdC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuXHRcdFx0XHQuc2V0UGxhY2Vob2xkZXIoJ01lbnNhcGxhbi5tZCcpXG5cdFx0XHRcdC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5tZW5zYXBsYW5GaWxlKVxuXHRcdFx0XHQub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3MubWVuc2FwbGFuRmlsZSA9IHZhbHVlO1xuXHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXHRcdFx0XHR9KSk7XG5cdH1cbn1cbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxzQkFBc0g7QUFFdEgsMkJBQXFCO0FBQ3JCLGdCQUFxQztBQWVyQyxJQUFNLG1CQUFxQztBQUFBLEVBQzFDLFlBQVk7QUFBQSxFQUNaLGFBQWE7QUFBQSxFQUNiLGVBQWU7QUFBQSxFQUNmLFdBQVc7QUFBQSxFQUNYLFVBQVU7QUFBQSxFQUNWLGtCQUFrQjtBQUNuQjtBQUVBLElBQXFCLFVBQXJCLGNBQXFDLHVCQUFPO0FBQUEsRUFBNUM7QUFBQTtBQVVDLFNBQVMsb0JBQTRCO0FBQUE7QUFBQSxFQUVyQyxNQUFNLFNBQVM7QUFDZCxV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
